<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Mysql on Skylm</title>
        <link>https://skylm808.github.io/categories/mysql/</link>
        <description>Recent content in Mysql on Skylm</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>Skylm</copyright>
        <lastBuildDate>Fri, 30 Jan 2026 10:56:48 +0800</lastBuildDate><atom:link href="https://skylm808.github.io/categories/mysql/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>MySQL InnoDB äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ MVCC æœºåˆ¶è¯¦è§£</title>
        <link>https://skylm808.github.io/p/mysql-innodb-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E-mvcc-%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</link>
        <pubDate>Fri, 30 Jan 2026 10:56:48 +0800</pubDate>
        
        <guid>https://skylm808.github.io/p/mysql-innodb-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E-mvcc-%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</guid>
        <description>&lt;h1 id=&#34;mysql-innodb-åœ¨-rr-çº§åˆ«ä¸‹è§£å†³å¹»è¯»çš„ä¸¤ç§æ–¹æ¡ˆè¯¦è§£&#34;&gt;MySQL InnoDB åœ¨ RR çº§åˆ«ä¸‹è§£å†³å¹»è¯»çš„ä¸¤ç§æ–¹æ¡ˆè¯¦è§£
&lt;/h1&gt;&lt;p&gt;å…³äº &lt;strong&gt;å¹»è¯» (Phantom Read)&lt;/strong&gt;ï¼Œå¾ˆå¤šäººçš„ç†è§£ä»…åœç•™åœ¨â€œæ’å…¥äº†ä¸€æ¡æ–°æ•°æ®â€ï¼Œä½†æ›´æ·±å…¥çš„é—®é¢˜æ˜¯ï¼š&lt;strong&gt;MySQL é»˜è®¤çš„ Repeatable Read (RR) åˆ°åº•æœ‰æ²¡æœ‰å®Œå…¨è§£å†³å¹»è¯»ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯ï¼š&lt;strong&gt;å¤§éƒ¨åˆ†è§£å†³äº†ï¼Œä½†æ²¡å®Œå…¨è§£å†³ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB ä½¿ç”¨äº†ä¸¤å¥—ä¸åŒçš„æœºåˆ¶æ¥åº”å¯¹ä¸åŒçš„è¯»å–åœºæ™¯ï¼ˆå¿«ç…§è¯» vs å½“å‰è¯»ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;1-åœºæ™¯ä¸€å¿«ç…§è¯»-snapshot-read&#34;&gt;1. åœºæ™¯ä¸€ï¼šå¿«ç…§è¯» (Snapshot Read)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;SQL è¯­å¥&lt;/strong&gt;ï¼šæ™®é€šçš„ &lt;code&gt;SELECT * FROM table ...&lt;/code&gt;ï¼ˆä¸åŠ é”ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;æœºåˆ¶mvcc-å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶&#34;&gt;æœºåˆ¶ï¼šMVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)
&lt;/h3&gt;&lt;p&gt;åœ¨ RR çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡å¯åŠ¨åçš„&lt;strong&gt;ç¬¬ä¸€æ¬¡æŸ¥è¯¢&lt;/strong&gt;ä¼šç”Ÿæˆä¸€ä¸ª &lt;strong&gt;Read View (ä¸€è‡´æ€§è§†å›¾)&lt;/strong&gt;ï¼Œåç»­æ‰€æœ‰çš„æŸ¥è¯¢éƒ½å¤ç”¨è¿™ä¸ªè§†å›¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºä»€ä¹ˆèƒ½è§£å†³å¹»è¯»&#34;&gt;ä¸ºä»€ä¹ˆèƒ½è§£å†³å¹»è¯»ï¼Ÿ
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å°±åƒæ‹äº†ä¸€å¼ ç…§ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;å³ä½¿åˆ«çš„äº‹åŠ¡ B &lt;strong&gt;æ’å…¥ (Insert)&lt;/strong&gt; äº†å‡ ç™¾æ¡æ–°æ•°æ®å¹¶æäº¤äº†ã€‚&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡ A å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œæ‹¿ç€æ‰‹é‡Œçš„ Read View ä¸€æ¯”å¯¹ï¼Œå‘ç°è¿™äº›æ–°æ•°æ®çš„äº‹åŠ¡ ID (&lt;code&gt;DB_TRX_ID&lt;/code&gt;) æ¯”è‡ªå·±çš„ Read View è¿˜å¤§ï¼ˆå±äºæœªæ¥æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šäº‹åŠ¡ A æ ¹æœ¬çœ‹ä¸è§è¿™äº›æ–°æ•°æ®ã€‚å¯¹å®ƒæ¥è¯´ï¼Œå¹»è¯»ä»æœªå‘ç”Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šåœ¨çº¯ç²¹çš„å¿«ç…§è¯»åœºæ™¯ä¸‹ï¼Œ&lt;strong&gt;MVCC å®Œç¾è§£å†³äº†å¹»è¯»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;2-åœºæ™¯äºŒå½“å‰è¯»-current-read&#34;&gt;2. åœºæ™¯äºŒï¼šå½“å‰è¯» (Current Read)
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;SQL è¯­å¥&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;SELECT ... FOR UPDATE&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;SELECT ... LOCK IN SHARE MODE&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;UPDATE ...&lt;/code&gt; / &lt;code&gt;DELETE ...&lt;/code&gt; / &lt;code&gt;INSERT ...&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šè¿™äº›æ“ä½œéœ€è¦è¯»å–æ•°æ®åº“&lt;strong&gt;æœ€æ–°ã€æœ€çœŸå®&lt;/strong&gt;çš„æ•°æ®ï¼Œä¸èƒ½çœ‹è€ç…§ç‰‡ï¼Œå¦åˆ™ä¼šè¦†ç›–åˆ«äººçš„æ›´æ–°ï¼Œå¯¼è‡´æ•°æ®é”™ä¹±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æœºåˆ¶next-key-lock-ä¸´é”®é”&#34;&gt;æœºåˆ¶ï¼šNext-Key Lock (ä¸´é”®é”)
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Next-Key Lock = Record Lock (è¡Œé”) + Gap Lock (é—´éš™é”)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;InnoDB ä¸ä»…é”ä½æ‰«æåˆ°çš„&lt;strong&gt;è¡Œ&lt;/strong&gt;ï¼Œè¿˜ä¼šé”ä½è¡Œä¸è¡Œä¹‹é—´çš„&lt;strong&gt;é—´éš™&lt;/strong&gt;ï¼Œå½»åº•æœç»åˆ«äººåœ¨è¿™ä¸ªèŒƒå›´å†…â€œæ’é˜Ÿâ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¡ˆä¾‹æ¼”ç¤ºå¦‚ä½•é”æ­»å¹»è¯»&#34;&gt;æ¡ˆä¾‹æ¼”ç¤ºï¼šå¦‚ä½•é”æ­»å¹»è¯»ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Next-Key Lock&lt;/strong&gt; çš„æ ¸å¿ƒåœ¨äºâ€œå·¦å¼€å³é—­â€åŒºé—´ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾è¡¨é‡Œç°æœ‰æ•°æ®ï¼š&lt;code&gt;id = 3, 5&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;äº‹åŠ¡ A æ‰§è¡Œ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;WHERE&lt;/span&gt; id &lt;span style=&#34;color:#ff79c6&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;UPDATE&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;em&gt;æ³¨ï¼šè™½ç„¶è¿™é‡Œæ˜¯ç­‰å€¼æŸ¥è¯¢ï¼Œä½†å¦‚æœ id ä¸æ˜¯ä¸»é”®/å”¯ä¸€ç´¢å¼•ï¼Œæˆ–è€…æŸ¥è¯¢æ¡ä»¶æ˜¯èŒƒå›´ï¼ŒInnoDB ä¾ç„¶ä¼šåŠ é—´éš™é”ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£èŒƒå›´é”ï¼Œæˆ‘ä»¬å‡è®¾è¿™æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢æˆ–è€…éå”¯ä¸€ç´¢å¼•æŸ¥è¯¢ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´å…¸å‹çš„èŒƒå›´æŸ¥è¯¢ä¾‹å­&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ff79c6&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;WHERE&lt;/span&gt; id &lt;span style=&#34;color:#ff79c6&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color:#bd93f9&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color:#ff79c6&#34;&gt;UPDATE&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;InnoDB çš„é”å®šèŒƒå›´ (Next-Key Lock)&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è®°å½•é”&lt;/strong&gt;ï¼šé”ä½ &lt;code&gt;id = 5&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é—´éš™é”&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é”ä½ &lt;code&gt;(3, 5]&lt;/code&gt;ï¼šå³ 3 åˆ° 5 ä¹‹é—´çš„ç©ºéš™ï¼ˆå« 5ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é”ä½ &lt;code&gt;(5, +âˆ)&lt;/code&gt;ï¼š5 ä¹‹åçš„æ— é™ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼š
æ­¤æ—¶ï¼Œå¦‚æœäº‹åŠ¡ B å°è¯•æ“ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;INSERT 4&lt;/strong&gt;ï¼šè½åœ¨ &lt;code&gt;(3, 5]&lt;/code&gt; åŒºé—´ -&amp;gt; &lt;strong&gt;é˜»å¡ (Blocked)&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;INSERT 10&lt;/strong&gt;ï¼šè½åœ¨ &lt;code&gt;(5, +âˆ)&lt;/code&gt; åŒºé—´ -&amp;gt; &lt;strong&gt;é˜»å¡ (Blocked)&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;INSERT 1&lt;/strong&gt;ï¼šè½åœ¨ &lt;code&gt;(-âˆ, 3]&lt;/code&gt; åŒºé—´ï¼ˆæ²¡è¢«é”ï¼‰ -&amp;gt; &lt;strong&gt;âœ… æˆåŠŸæ’å…¥ï¼&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼š
Next-Key Lock ç²¾å‡†åœ°é”ä½äº†&lt;strong&gt;æŸ¥è¯¢æ¡ä»¶è¦†ç›–çš„èŒƒå›´åŠå…¶åç»­é—´éš™&lt;/strong&gt;ã€‚å®ƒå¹¶æ²¡æœ‰é”ä½å…¨è¡¨ï¼Œä¸ç›¸å…³çš„åŒºé—´ï¼ˆæ¯”å¦‚ id=1ï¼‰ä¾ç„¶å¯ä»¥è‡ªç”±æ’å…¥ï¼Œæ—¢é˜²æ­¢äº†å¹»è¯»ï¼Œåˆä¿ç•™äº†ä¸€å®šçš„å¹¶å‘æ€§èƒ½ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;3-ç‰¹æ®Šåœºæ™¯å¹»è¯»åœ¨å“ªé‡Œéœ²é¦…äº†&#34;&gt;3. ç‰¹æ®Šåœºæ™¯ï¼šå¹»è¯»åœ¨å“ªé‡Œâ€œéœ²é¦…â€äº†ï¼Ÿ
&lt;/h3&gt;&lt;p&gt;è™½ç„¶ MVCC å’Œ Next-Key Lock å®ˆå«æ£®ä¸¥ï¼Œä½†åœ¨ä¸€ç§æå…¶åˆé’»çš„â€œå…ˆæŸ¥åæ”¹â€åœºæ™¯ä¸‹ï¼Œå¹»è¯»ä¾ç„¶ä¼šå‘ç”Ÿã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¬ºéª—åœºæ™¯å¤ç°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹çŠ¶æ€&lt;/strong&gt;ï¼šè¡¨ä¸­æ—  &lt;code&gt;id=3&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ A&lt;/strong&gt;ï¼š&lt;code&gt;SELECT * FROM table WHERE id=3;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;ç»“æœ&lt;/em&gt;ï¼šç©ºé›†ï¼ˆMVCC å¿«ç…§è¯»ï¼Œæ­£å¸¸ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;çŠ¶æ€&lt;/em&gt;ï¼šç”Ÿæˆäº† Read Viewï¼Œæ­¤æ—¶çœ‹ä¸åˆ° id=3ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ B&lt;/strong&gt;ï¼š&lt;code&gt;INSERT INTO table VALUES (3); COMMIT;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;åŠ¨ä½œ&lt;/em&gt;ï¼šæ’å…¥å¹¶æäº¤ã€‚å› ä¸ºäº‹åŠ¡ A æ²¡åŠ é”ï¼ˆåªæ˜¯å¿«ç…§è¯»ï¼‰ï¼Œæ‰€ä»¥äº‹åŠ¡ B æˆåŠŸæ’å…¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;çŠ¶æ€&lt;/em&gt;ï¼šæ•°æ®åº“ç‰©ç†æ–‡ä»¶é‡Œæœ‰äº† id=3ï¼Œå…¶ &lt;code&gt;DB_TRX_ID&lt;/code&gt; = äº‹åŠ¡ Bã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ A&lt;/strong&gt;ï¼š&lt;code&gt;UPDATE table SET name=&#39;Hack&#39; WHERE id=3;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;åŠ¨ä½œ&lt;/em&gt;ï¼š&lt;strong&gt;UPDATE æ˜¯å½“å‰è¯»ï¼&lt;/strong&gt; å®ƒå¿…é¡»è¯»å–ç‰©ç†ä¸Šæœ€æ–°çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç»“æœ&lt;/em&gt;ï¼šæ›´æ–°æˆåŠŸï¼&lt;/li&gt;
&lt;li&gt;&lt;em&gt;å…³é”®å˜åŒ–&lt;/em&gt;ï¼š&lt;strong&gt;è¿™è¡Œæ•°æ®çš„ &lt;code&gt;DB_TRX_ID&lt;/code&gt; è¢«ä¿®æ”¹æˆäº†äº‹åŠ¡ A è‡ªå·±çš„ IDï¼&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;&lt;strong&gt;äº‹åŠ¡ A&lt;/strong&gt;ï¼š&lt;code&gt;SELECT * FROM table WHERE id=3;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;çµå¼‚äº‹ä»¶&lt;/em&gt;ï¼šæŸ¥åˆ°äº†ï¼&lt;/li&gt;
&lt;li&gt;&lt;em&gt;åŸå› &lt;/em&gt;ï¼šå†æ¬¡å¤ç”¨ Read View è¿›è¡Œæ£€æŸ¥æ—¶ï¼š
&lt;ul&gt;
&lt;li&gt;æ•°æ®çš„ &lt;code&gt;DB_TRX_ID&lt;/code&gt; æ˜¯äº‹åŠ¡ A è‡ªå·±ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¦åˆ MVCC è§„åˆ™ä¸€ï¼š&lt;strong&gt;â€œæˆ‘è‡ªå·±ä¿®æ”¹çš„æ•°æ®å¯è§â€&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ‰€ä»¥ï¼Œå¹»è¯»å‘ç”Ÿäº†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æ€»ç»“&lt;/strong&gt;ï¼š
è¿™å¹¶ä¸æ˜¯ Bugï¼Œè€Œæ˜¯ MVCC çš„è§„åˆ™é€»è¾‘è‡ªæ´½çš„ç»“æœã€‚è¿™ä¹Ÿæé†’æˆ‘ä»¬ï¼š&lt;strong&gt;ä¸è¦åœ¨åŒä¸€ä¸ªäº‹åŠ¡é‡Œæ··ç”¨å¿«ç…§è¯»å’Œå½“å‰è¯»æ¥å¤„ç†åŒä¸€æ‰¹æ•°æ®&lt;/strong&gt;ã€‚å¦‚æœä¸šåŠ¡é€»è¾‘éœ€è¦â€œå…ˆæŸ¥åæ”¹â€ï¼Œç¬¬ä¸€æ¬¡æŸ¥è¯¢å°±å¿…é¡»ä½¿ç”¨ &lt;code&gt;FOR UPDATE&lt;/code&gt; åŠ é”ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;4-æœ€ç»ˆç»“è®º&#34;&gt;4. æœ€ç»ˆç»“è®º
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;â€œMySQL çš„ RR çº§åˆ«æœ‰æ²¡æœ‰è§£å†³å¹»è¯»ï¼Ÿâ€&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯¹äºæ™®é€šæŸ¥è¯¢ (å¿«ç…§è¯»)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é  &lt;strong&gt;MVCC&lt;/strong&gt; è§£å†³ã€‚é€šè¿‡å¤ç”¨ Read Viewï¼Œåƒçœ‹è€ç…§ç‰‡ä¸€æ ·å±è”½äº†å¤–ç•Œçš„æ’å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;å¯¹äºåŠ é”æŸ¥è¯¢/ä¿®æ”¹ (å½“å‰è¯»)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;é  &lt;strong&gt;Next-Key Lock&lt;/strong&gt; è§£å†³ã€‚é€šè¿‡é”ä½è¡Œå’Œé—´éš™ï¼Œç‰©ç†ä¸Šé˜»æ­¢äº†æ–°æ•°æ®çš„æ’å…¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;ä¾‹å¤–æƒ…å†µ&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä¸€ä¸ªäº‹åŠ¡å…ˆè¿›è¡Œå¿«ç…§è¯»ï¼Œç„¶åè¿›è¡Œå½“å‰è¯»ï¼ˆUPDATE/DELETEï¼‰ï¼Œå†è¿›è¡Œå¿«ç…§è¯»ï¼Œå¯èƒ½ä¼šå› ä¸ºè‡ªå·±æ›´æ–°äº†åˆ«äº‹åŠ¡æ’å…¥çš„æ•°æ®ï¼Œå¯¼è‡´å¹»è¯»æ˜¾å½¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        <item>
        <title>MySQL InnoDB äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ MVCC æœºåˆ¶è¯¦è§£</title>
        <link>https://skylm808.github.io/p/mysql-innodb-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E-mvcc-%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</link>
        <pubDate>Thu, 29 Jan 2026 22:31:48 +0800</pubDate>
        
        <guid>https://skylm808.github.io/p/mysql-innodb-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E4%B8%8E-mvcc-%E6%9C%BA%E5%88%B6%E8%AF%A6%E8%A7%A3/</guid>
        <description>&lt;h1 id=&#34;mysql-innodb-äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸-mvcc-æœºåˆ¶è¯¦è§£&#34;&gt;MySQL InnoDB äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ MVCC æœºåˆ¶è¯¦è§£
&lt;/h1&gt;&lt;p&gt;åœ¨æ•°æ®åº“ç³»ç»Ÿä¸­ï¼Œ&lt;strong&gt;äº‹åŠ¡ï¼ˆTransactionï¼‰&lt;/strong&gt; æ˜¯ä¸€ç»„åŸå­æ€§çš„ SQL æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šã€‚å½“å¤šä¸ªäº‹åŠ¡åŒæ—¶æ‰§è¡Œæ—¶ï¼ˆå¹¶å‘ï¼‰ï¼Œå¯èƒ½ä¼šå‡ºç°å„ç§æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;MySQL çš„ InnoDB å­˜å‚¨å¼•æ“æä¾›äº†å››ç§&lt;strong&gt;äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆIsolation Levelï¼‰&lt;/strong&gt;ï¼Œç”¨æ¥å¹³è¡¡&lt;strong&gt;æ•°æ®å®‰å…¨æ€§&lt;/strong&gt;ï¼ˆä¸€è‡´æ€§ï¼‰å’Œ&lt;strong&gt;æ€§èƒ½&lt;/strong&gt;ï¼ˆå¹¶å‘æ€§ï¼‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;1-å¹¶å‘äº‹åŠ¡å¯èƒ½å¸¦æ¥çš„é—®é¢˜&#34;&gt;1. å¹¶å‘äº‹åŠ¡å¯èƒ½å¸¦æ¥çš„é—®é¢˜
&lt;/h2&gt;&lt;p&gt;åœ¨äº†è§£éš”ç¦»çº§åˆ«ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å¦‚æœä¸éš”ç¦»ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è„è¯» (Dirty Read)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡ A è¯»åˆ°äº†äº‹åŠ¡ B &lt;strong&gt;è¿˜æ²¡æœ‰æäº¤&lt;/strong&gt;çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;é£é™©&lt;/em&gt;ï¼šå¦‚æœäº‹åŠ¡ B å›æ»šäº†ï¼Œäº‹åŠ¡ A è¯»åˆ°çš„å°±æ˜¯â€œè„æ•°æ®â€ï¼ˆå®é™…ä¸Šä»æœªå­˜åœ¨è¿‡çš„æ•°æ®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯é‡å¤è¯» (Non-repeatable Read)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡ A åœ¨è‡ªå·±çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆåä¸¤æ¬¡è¯»å–åŒä¸€æ¡è®°å½•ã€‚åœ¨ä¸¤æ¬¡è¯»å–ä¹‹é—´ï¼Œäº‹åŠ¡ B &lt;strong&gt;ä¿®æ”¹&lt;/strong&gt;äº†è¿™æ¡è®°å½•å¹¶æäº¤äº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç»“æœ&lt;/em&gt;ï¼šäº‹åŠ¡ A å‘ç°ä¸¤æ¬¡è¯»åˆ°çš„æ•°æ®ä¸ä¸€æ ·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;å¹»è¯» (Phantom Read)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;äº‹åŠ¡ A æŒ‰æŸä¸ªæ¡ä»¶æŸ¥è¯¢ï¼ˆä¾‹å¦‚â€œæ‰€æœ‰åˆ†æ•°ä¸º 100 åˆ†çš„å­¦ç”Ÿâ€ï¼‰ï¼Œç¬¬ä¸€æ¬¡æŸ¥åˆ°äº† 5 ä¸ªäººã€‚æ­¤æ—¶ï¼Œäº‹åŠ¡ B &lt;strong&gt;æ’å…¥&lt;/strong&gt;äº†ä¸€ä¸ªæ–°çš„ 100 åˆ†å­¦ç”Ÿå¹¶æäº¤ã€‚äº‹åŠ¡ A å†æ¬¡æŒ‰ç›¸åŒæ¡ä»¶æŸ¥è¯¢ï¼Œå‘ç°å˜æˆäº† 6 ä¸ªäººã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;ç»“æœ&lt;/em&gt;ï¼šå°±åƒäº§ç”Ÿäº†å¹»è§‰ä¸€æ ·ï¼Œå¤šï¼ˆæˆ–å°‘ï¼‰äº†ä¸€äº›è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ğŸ’¡ æ ¸å¿ƒåŒºåˆ«è¾¨æï¼šä¸å¯é‡å¤è¯» vs å¹»è¯»&lt;/strong&gt;
å¾ˆå¤šäººå®¹æ˜“æ··æ·†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå…³é”®åŒºåˆ«åœ¨äº &lt;strong&gt;â€œå˜çš„æ˜¯ä»€ä¹ˆâ€&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸å¯é‡å¤è¯»&lt;/strong&gt; å…³æ³¨çš„æ˜¯ &lt;strong&gt;ä¿®æ”¹ (UPDATE)&lt;/strong&gt;ã€‚å³ï¼š&lt;strong&gt;ä»¥å‰è¯»åˆ°çš„æ•°æ®å˜äº†&lt;/strong&gt;ã€‚è§£å†³å®ƒé€šå¸¸åªéœ€è¦é”ä½è¡Œï¼ˆè¡Œé”ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¹»è¯»&lt;/strong&gt; å…³æ³¨çš„æ˜¯ &lt;strong&gt;æ’å…¥ (INSERT)&lt;/strong&gt;ã€‚å³ï¼š&lt;strong&gt;ä»¥å‰æ²¡è¯»åˆ°çš„æ•°æ®çªç„¶å†’å‡ºæ¥äº†&lt;/strong&gt;ï¼ˆæˆ–è€…åŸæœ¬æœ‰çš„æ¶ˆå¤±äº†ï¼‰ã€‚è§£å†³å®ƒéœ€è¦é”ä½è¡Œä¹‹é—´çš„ç©ºéš™ï¼ˆé—´éš™é”ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h2 id=&#34;2-å››ç§éš”ç¦»çº§åˆ«è¯¦è§£&#34;&gt;2. å››ç§éš”ç¦»çº§åˆ«è¯¦è§£
&lt;/h2&gt;&lt;p&gt;MySQL æŒ‰ç…§ SQL æ ‡å‡†å®šä¹‰äº†å››ç§éš”ç¦»çº§åˆ«ï¼Œä¸¥æ ¼ç¨‹åº¦ä»ä½åˆ°é«˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;21-read-uncommitted-è¯»æœªæäº¤&#34;&gt;2.1 READ UNCOMMITTED (è¯»æœªæäº¤)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šè¿™æ˜¯æœ€ä½çš„éš”ç¦»çº§åˆ«ã€‚ä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–å¦ä¸€ä¸ª&lt;strong&gt;æœªæäº¤&lt;/strong&gt;äº‹åŠ¡ä¿®æ”¹çš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿—è§£é‡Š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;å°±åƒä½ åœ¨å†™ä½œä¸šï¼ˆäº‹åŠ¡ Bï¼‰ï¼Œè¿˜æ²¡äº¤ç»™è€å¸ˆï¼ˆæœªæäº¤ï¼‰ï¼ŒåŒæ¡Œï¼ˆäº‹åŠ¡ Aï¼‰å°±å·çœ‹äº†ä½ çš„ç­”æ¡ˆã€‚å¦‚æœä½ å‘ç°å†™é”™äº†æ“¦æ‰é‡å†™ï¼ˆå›æ»šï¼‰ï¼ŒåŒæ¡ŒæŠ„çš„å°±æ˜¯é”™çš„ï¼ˆè„è¯»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜åœ¨é—®é¢˜&lt;/strong&gt;ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨åœºæ™¯&lt;/strong&gt;ï¼šæå°‘ä½¿ç”¨ï¼Œæ€§èƒ½è™½é«˜ä½†æä¸å®‰å…¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;22-read-committed-è¯»å·²æäº¤--rc&#34;&gt;2.2 READ COMMITTED (è¯»å·²æäº¤ / RC)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šä¸€ä¸ªäº‹åŠ¡åªèƒ½è¯»å–å·²ç»&lt;strong&gt;æäº¤&lt;/strong&gt;çš„æ•°æ®ã€‚è¿™æ˜¯å¤§å¤šæ•°æ•°æ®åº“ï¼ˆå¦‚ Oracle, PostgreSQLï¼‰çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿—è§£é‡Š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ ï¼ˆäº‹åŠ¡ Aï¼‰åœ¨æŸ¥è´¦ï¼Œçœ‹åˆ°ä½™é¢æ˜¯ 100 å…ƒã€‚æ­¤æ—¶ä½ è€å©†ï¼ˆäº‹åŠ¡ Bï¼‰èŠ±äº† 50 å…ƒå¹¶ç¡®è®¤æ”¯ä»˜ï¼ˆæäº¤ï¼‰ã€‚ä½ å†æ¬¡æŸ¥è´¦ï¼Œå‘ç°ä½™é¢å˜æˆäº† 50 å…ƒã€‚&lt;/li&gt;
&lt;li&gt;è™½ç„¶é¿å…äº†è¯»è‰ç¨¿ï¼ˆè„è¯»ï¼‰ï¼Œä½†åŒä¸€ä¸ªäº‹åŠ¡é‡Œæ•°æ®å˜äº†ï¼Œè®©ä½ å¾ˆå›°æƒ‘ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜åœ¨é—®é¢˜&lt;/strong&gt;ï¼šä¸å¯é‡å¤è¯»ã€å¹»è¯»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³äº†&lt;/strong&gt;ï¼šè„è¯»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;23-repeatable-read-å¯é‡å¤è¯»--rr--mysql-é»˜è®¤çº§åˆ«&#34;&gt;2.3 REPEATABLE READ (å¯é‡å¤è¯» / RR) â€”â€” &lt;strong&gt;MySQL é»˜è®¤çº§åˆ«&lt;/strong&gt;
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šç¡®ä¿åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¤šæ¬¡è¯»å–åŒæ ·çš„æ•°æ®ç»“æœæ˜¯ä¸€æ ·çš„ã€‚å³ä½¿å…¶ä»–äº‹åŠ¡æäº¤äº†ä¿®æ”¹ï¼Œæœ¬äº‹åŠ¡çœ‹åˆ°çš„ä¾ç„¶æ˜¯äº‹åŠ¡å¼€å§‹æ—¶çš„çŠ¶æ€ï¼ˆå¿«ç…§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿—è§£é‡Š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ ï¼ˆäº‹åŠ¡ Aï¼‰æ‰“å¼€è´¦æœ¬å¼€å§‹æŸ¥è´¦ï¼ˆå¼€å¯äº‹åŠ¡ï¼‰ï¼Œæ­¤æ—¶ä½™é¢ 100 å…ƒã€‚è¿™å°±å¥½æ¯”ä½ å¯¹è´¦æœ¬æ‹äº†ä¸€å¼ &lt;strong&gt;ç…§ç‰‡&lt;/strong&gt;ã€‚æ— è®ºä½ è€å©†ï¼ˆäº‹åŠ¡ Bï¼‰æ€ä¹ˆèŠ±é’±ã€æ€ä¹ˆæäº¤ï¼Œä½ ç›¯ç€ç…§ç‰‡çœ‹ï¼Œä½™é¢æ°¸è¿œæ˜¯ 100 å…ƒã€‚ç›´åˆ°ä½ è‡ªå·±ç»“æŸæŸ¥è´¦ï¼ˆæäº¤/å›æ»šï¼‰ï¼Œæ”¾ä¸‹ç…§ç‰‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº•å±‚æœºåˆ¶&lt;/strong&gt;ï¼šInnoDB ä¸»è¦é€šè¿‡ &lt;strong&gt;MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)&lt;/strong&gt; æ¥å®ç°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…³äºå¹»è¯»&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;SQL æ ‡å‡†è§„å®š RR çº§åˆ«æ— æ³•è§£å†³å¹»è¯»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½†æ˜¯&lt;/strong&gt;ï¼ŒMySQL çš„ InnoDB å¼•æ“éå¸¸å¼ºå¤§ï¼Œå®ƒåœ¨ RR çº§åˆ«ä¸‹é€šè¿‡ &lt;strong&gt;Next-Key Lock (é—´éš™é”)&lt;/strong&gt; æœºåˆ¶ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†å¹»è¯»çš„å‘ç”Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³äº†&lt;/strong&gt;ï¼šè„è¯»ã€ä¸å¯é‡å¤è¯»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;24-serializable-ä¸²è¡ŒåŒ–&#34;&gt;2.4 SERIALIZABLE (ä¸²è¡ŒåŒ–)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ã€‚å®ƒå¼ºåˆ¶äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼ˆæ’é˜Ÿï¼‰ï¼Œé€šè¿‡å¼ºåˆ¶å¯¹è¯»å–çš„æ•°æ®åŠ é”ï¼Œé¿å…ä¸€åˆ‡å†²çªã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€šä¿—è§£é‡Š&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½ ï¼ˆäº‹åŠ¡ Aï¼‰è¦æŸ¥è´¦ï¼Œç³»ç»Ÿç›´æ¥æŠŠè´¦æœ¬é”è¿›ä¿é™©æŸœï¼Œé’¥åŒ™ç»™ä½ ã€‚ä½ è€å©†ï¼ˆäº‹åŠ¡ Bï¼‰æƒ³èŠ±é’±ï¼Ÿå¯¹ä¸èµ·ï¼Œæ’é˜Ÿç­‰ç€ï¼Œç›´åˆ°ä½ æŸ¥å®ŒæŠŠé’¥åŒ™è¿˜å›å»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­˜åœ¨é—®é¢˜&lt;/strong&gt;ï¼šæ€§èƒ½æå·®ï¼Œå¹¶å‘åº¦æä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§£å†³äº†&lt;/strong&gt;ï¼šæ‰€æœ‰å¹¶å‘é—®é¢˜ï¼ˆè„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;3-æ€»ç»“ä¸å¯¹æ¯”&#34;&gt;3. æ€»ç»“ä¸å¯¹æ¯”
&lt;/h2&gt;&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;éš”ç¦»çº§åˆ«&lt;/th&gt;
          &lt;th&gt;è„è¯» (Dirty Read)&lt;/th&gt;
          &lt;th&gt;ä¸å¯é‡å¤è¯» (Non-Repeatable)&lt;/th&gt;
          &lt;th&gt;å¹»è¯» (Phantom Read)&lt;/th&gt;
          &lt;th&gt;æ€§èƒ½&lt;/th&gt;
          &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Read Uncommitted&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;å¯èƒ½&lt;/td&gt;
          &lt;td&gt;å¯èƒ½&lt;/td&gt;
          &lt;td&gt;å¯èƒ½&lt;/td&gt;
          &lt;td&gt;æé«˜&lt;/td&gt;
          &lt;td&gt;åŸºæœ¬ä¸ç”¨ï¼Œæ•°æ®ä¸å¯é &lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Read Committed&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;å¯èƒ½&lt;/td&gt;
          &lt;td&gt;å¯èƒ½&lt;/td&gt;
          &lt;td&gt;é«˜&lt;/td&gt;
          &lt;td&gt;Oracle/PG é»˜è®¤ï¼Œäº’è”ç½‘å¤§å‚å¸¸ç”¨&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Repeatable Read&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;å¯èƒ½ (InnoDB å¤§éƒ¨åˆ†é¿å…)&lt;/td&gt;
          &lt;td&gt;ä¸­&lt;/td&gt;
          &lt;td&gt;&lt;strong&gt;MySQL é»˜è®¤&lt;/strong&gt;ï¼Œå¤Ÿç”¨ä¸”å®‰å…¨&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;Serializable&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;âŒ é¿å…&lt;/td&gt;
          &lt;td&gt;ä½&lt;/td&gt;
          &lt;td&gt;åªæœ‰æé«˜ä¸€è‡´æ€§è¦æ±‚æ—¶æ‰ç”¨&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h2 id=&#34;4-æç®€é€šä¿—æ¡ˆä¾‹ä¹°é™é‡æ‰‹åŠ&#34;&gt;4. æç®€é€šä¿—æ¡ˆä¾‹ï¼šä¹°é™é‡æ‰‹åŠ
&lt;/h2&gt;&lt;p&gt;å‡è®¾å•†åº—é‡Œè¿˜å‰© &lt;strong&gt;1 ä¸ª&lt;/strong&gt; é™é‡ç‰ˆæ‰‹åŠï¼Œåº“å­˜æ˜¾ç¤ºä¸º 1ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯»æœªæäº¤&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¹°å®¶ A ä¸‹å•äº†ï¼ˆåº“å­˜-1ï¼Œå‰©0ï¼‰ï¼Œè¿˜æ²¡ä»˜æ¬¾ï¼ˆæœªæäº¤ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¹°å®¶ B ä¸€çœ‹ï¼Œåº“å­˜æ˜¯ 0ï¼Œå¤±æœ›ç¦»å¼€ã€‚&lt;/li&gt;
&lt;li&gt;ç»“æœä¹°å®¶ A æ²¡é’±ä»˜æ¬¾å–æ¶ˆäº†ï¼ˆå›æ»šï¼Œåº“å­˜+1ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¹°å®¶ B è¢«å‘äº†&lt;/strong&gt;ï¼ˆè„è¯»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;&lt;strong&gt;è¯»å·²æäº¤&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¹°å®¶ A ä¸‹å•å¹¶ä»˜æ¬¾æˆåŠŸï¼ˆæäº¤ï¼Œåº“å­˜å˜ 0ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¹°å®¶ B ç¬¬ä¸€æ¬¡çœ‹åº“å­˜æ˜¯ 1ï¼Œæ­£é«˜å…´å‘¢ï¼Œåˆ·æ–°ç½‘é¡µï¼ˆç¬¬äºŒæ¬¡è¯»ï¼‰ï¼Œåº“å­˜å˜æˆ 0 äº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¹°å®¶ B å¿ƒæƒ…å¤§èµ·å¤§è½&lt;/strong&gt;ï¼ˆä¸å¯é‡å¤è¯»ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;&lt;strong&gt;å¯é‡å¤è¯» (MySQL é»˜è®¤)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¹°å®¶ B è¿›å…¥è´­ä¹°é¡µé¢ï¼ˆå¼€å¯äº‹åŠ¡ï¼‰ï¼Œçœ‹åˆ°åº“å­˜æ˜¯ 1ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ä¹°å®¶ A æŠ¢å…ˆä¹°èµ°å¹¶ä»˜æ¬¾ï¼ˆåº“å­˜å˜ 0ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¹°å®¶ B åªè¦ä¸åˆ·æ–°é€€å‡ºï¼Œæ€ä¹ˆçœ‹åº“å­˜éƒ½æ˜¯ 1ï¼ˆçœ‹çš„æ˜¯å¿«ç…§ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æ³¨ï¼šè™½ç„¶çœ‹åˆ°çš„è¿˜æ˜¯ 1ï¼Œä½†å¦‚æœä¹°å®¶ B å°è¯•ä¸‹å•ï¼Œæ•°æ®åº“é”æœºåˆ¶ä¼šå‘Šè¯‰ä»–å…¶å®æ²¡è´§äº†ã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;ä¸²è¡ŒåŒ–&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ä¹°å®¶ B æ­£åœ¨çœ‹æ‰‹åŠè¯¦æƒ…é¡µã€‚&lt;/li&gt;
&lt;li&gt;ä¹°å®¶ A æƒ³ä¸‹å•ï¼Ÿ&lt;strong&gt;å¡ä½ä¸åŠ¨&lt;/strong&gt;ï¼Œç›´åˆ°ä¹°å®¶ B å…³æ‰ç½‘é¡µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤§å®¶éƒ½è¦ç–¯äº†&lt;/strong&gt;ï¼ˆæ€§èƒ½å¤ªå·®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id=&#34;5-æ·±å…¥ç†è§£-mvcc-å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶&#34;&gt;5. æ·±å…¥ç†è§£ MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)
&lt;/h2&gt;&lt;p&gt;MySQL çš„é»˜è®¤éš”ç¦»çº§åˆ« &lt;strong&gt;Repeatable Read (RR)&lt;/strong&gt; æ˜¯å¦‚ä½•åšåˆ°â€œå¯é‡å¤è¯»â€ä¸”ä¸åŠ é”å½±å“æ€§èƒ½çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ &lt;strong&gt;MVCC (Multi-Version Concurrency Control)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;51-ä»€ä¹ˆæ˜¯-mvcc&#34;&gt;5.1 ä»€ä¹ˆæ˜¯ MVCCï¼Ÿ
&lt;/h3&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼ŒMVCC å°±æ˜¯è®©æ¯è¡Œæ•°æ®éƒ½æ‹¥æœ‰&lt;strong&gt;å¤šä¸ªç‰ˆæœ¬&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯»ä¸åŠ é”&lt;/strong&gt;ï¼šè¯»å–æ•°æ®æ—¶ï¼Œä¸åŠ é”ï¼Œè€Œæ˜¯å»è¯»ç¬¦åˆå½“å‰äº‹åŠ¡æ—¶é—´ç‚¹çš„é‚£ä¸ªâ€œæ—§ç‰ˆæœ¬â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†™åŠ é”&lt;/strong&gt;ï¼šå†™å…¥æ•°æ®æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šæœ€å¤§ç¨‹åº¦æé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ï¼Œå®ç°â€œè¯»å†™ä¸å†²çªâ€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ“¸ &lt;strong&gt;æ¯”å–»&lt;/strong&gt;ï¼šå°±åƒç»™æ–‡æ¡£åšâ€œç‰ˆæœ¬æ§åˆ¶â€ï¼ˆå¦‚ Gitï¼‰ã€‚ä½ æ­£åœ¨ç¼–è¾‘ v2 ç‰ˆï¼Œåˆ«äººå¯ä»¥æ”¾å¿ƒè¯» v1 ç‰ˆï¼Œäº’ä¸å¹²æ‰°ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;52-mvcc-çš„ä¸‰å¤§æ ¸å¿ƒç»„ä»¶&#34;&gt;5.2 MVCC çš„ä¸‰å¤§æ ¸å¿ƒç»„ä»¶
&lt;/h3&gt;&lt;p&gt;InnoDB å®ç° MVCC ä¾èµ–ä¸‰ä¸ªä¸œè¥¿ï¼š&lt;strong&gt;éšå¼å­—æ®µ&lt;/strong&gt;ã€&lt;strong&gt;Undo Log&lt;/strong&gt; å’Œ &lt;strong&gt;Read View&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1-éšå¼å­—æ®µ&#34;&gt;1. éšå¼å­—æ®µ
&lt;/h4&gt;&lt;p&gt;æ¯è¡Œè®°å½•é™¤äº†ä½ å®šä¹‰çš„åˆ—ä¹‹å¤–ï¼ŒInnoDB ä¼šæ‚„æ‚„åŠ å‡ ä¸ªéšè—åˆ—ï¼Œæœ€é‡è¦çš„ä¸¤ä¸ªæ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DB_TRX_ID&lt;/code&gt; (äº‹åŠ¡ ID) â€”â€” â€œæœ€æ–°ä¿®æ”¹è€…çš„èº«ä»½è¯â€&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒè®°å½•äº†&lt;strong&gt;æœ€åä¸€æ¬¡&lt;/strong&gt;ä¿®æ”¹ï¼ˆæˆ–æ’å…¥ï¼‰è¿™è¡Œè®°å½•çš„äº‹åŠ¡ IDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå®ƒæ ‡è¯†çš„æ˜¯&lt;strong&gt;å½“å‰è¿™è¡Œæ•°æ®å†…å®¹&lt;/strong&gt;æ˜¯ç”±å“ªä¸ªäº‹åŠ¡ç”Ÿæˆçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ã€åœºæ™¯ä¸¾ä¾‹ã€‘&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;äº‹åŠ¡ A (ID=10) æ’å…¥äº†ä¸€è¡Œæ•°æ® &amp;ldquo;Name: Jack&amp;rdquo;ã€‚æ­¤æ—¶è¿™è¡Œæ•°æ®çš„ &lt;code&gt;DB_TRX_ID&lt;/code&gt; å°±æ˜¯ &lt;strong&gt;10&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;åæ¥ï¼Œäº‹åŠ¡ B (ID=20) æŠŠ &amp;ldquo;Jack&amp;rdquo; æ”¹æˆäº† &amp;ldquo;Rose&amp;rdquo;ã€‚æ­¤æ—¶è¿™è¡Œæ•°æ®çš„ &lt;code&gt;DB_TRX_ID&lt;/code&gt; å°±å˜æˆäº† &lt;strong&gt;20&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“è®º&lt;/strong&gt;ï¼šå®ƒå°±åƒå•†å“çš„â€œç”Ÿäº§æ‰¹å·â€ï¼Œæ ‡è®°äº†&lt;strong&gt;å½“å‰æœ€æ–°ç‰ˆæ•°æ®&lt;/strong&gt;æ˜¯ç”±å“ªä¸ªäº‹åŠ¡äº§ç”Ÿçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DB_ROLL_PTR&lt;/code&gt; (å›æ»šæŒ‡é’ˆ) â€”â€” â€œç©¿è¶Šå›æ—§ç‰ˆçš„æ—¶å…‰éš§é“â€&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ Undo Log ä¸­è¿™è¡Œæ•°æ®çš„&lt;strong&gt;ä¸Šä¸€ä¸ªç‰ˆæœ¬&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å®ƒï¼Œæ•°æ®åº“å¯ä»¥åƒâ€œç©¿ç³–è‘«èŠ¦â€ä¸€æ ·ï¼Œé¡ºè—¤æ‘¸ç“œæ‰¾åˆ°è¿™è¡Œæ•°æ®ä¹‹å‰çš„æ‰€æœ‰å†å²çŠ¶æ€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ã€åœºæ™¯ä¸¾ä¾‹ã€‘&lt;/strong&gt;ï¼š
&lt;ol&gt;
&lt;li&gt;å½“äº‹åŠ¡ B æŠŠ &amp;ldquo;Jack&amp;rdquo; æ”¹æˆ &amp;ldquo;Rose&amp;rdquo; æ—¶ï¼ŒMySQL ä¸ä¼šç›´æ¥æŠŠ &amp;ldquo;Jack&amp;rdquo; åˆ äº†ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒä¼šå…ˆæŠŠ &amp;ldquo;Jack&amp;rdquo; è¿™ä¸ªæ—§ç‰ˆæœ¬æ‹·è´ä¸€ä»½æ‰”è¿› &lt;strong&gt;Undo Log&lt;/strong&gt; é‡Œã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œç”± &amp;ldquo;Rose&amp;rdquo; è¿™è¡Œæ–°æ•°æ®èº«ä¸Šçš„ &lt;code&gt;DB_ROLL_PTR&lt;/code&gt; æŒ‡å‘ Undo Log é‡Œçš„ &amp;ldquo;Jack&amp;rdquo;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•ˆæœ&lt;/strong&gt;ï¼šæ–°æ•°æ® (Rose) -&amp;gt; æ‹¿ç€ç»³å­ (æŒ‡é’ˆ) -&amp;gt; æ‹´ç€æ—§æ•°æ® (Jack)ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;DB_ROW_ID&lt;/code&gt; (è¡Œ ID)&lt;/strong&gt;ï¼šå¦‚æœä½ æ²¡è®¾ä¸»é”®ï¼ŒInnoDB å°±ç”¨å®ƒè‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-undo-log-å›æ»šæ—¥å¿—--æ•°æ®çš„ç‰ˆæœ¬é“¾&#34;&gt;2. Undo Log (å›æ»šæ—¥å¿—) â€”â€” æ•°æ®çš„â€œç‰ˆæœ¬é“¾â€
&lt;/h4&gt;&lt;p&gt;å½“ä¿®æ”¹æ•°æ®æ—¶ï¼Œæ—§æ•°æ®ä¸ä¼šç«‹åˆ»æ¶ˆå¤±ï¼Œè€Œæ˜¯è¢«æ”¾è¿›äº† &lt;strong&gt;Undo Log&lt;/strong&gt;ã€‚
é€šè¿‡ &lt;code&gt;DB_ROLL_PTR&lt;/code&gt; æŒ‡é’ˆï¼Œæ–°è€æ•°æ®è¿æˆäº†ä¸€ä¸ª&lt;strong&gt;ç‰ˆæœ¬é“¾&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ã€å›¾è§£ï¼šç‰ˆæœ¬é“¾æ˜¯å¦‚ä½•å½¢æˆçš„ã€‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€è¡Œæ•°æ® &lt;code&gt;id=1, name=A&lt;/code&gt;ï¼Œéšæ—¶é—´å‘ç”Ÿäº†ä¸‰æ¬¡å˜åŒ–ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹çŠ¶æ€&lt;/strong&gt;ï¼šäº‹åŠ¡ 100 æ’å…¥æ•°æ® &amp;ldquo;A&amp;rdquo;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬ä¸€æ¬¡ä¿®æ”¹&lt;/strong&gt;ï¼šäº‹åŠ¡ 200 æŠŠ &amp;ldquo;A&amp;rdquo; æ”¹ä¸º &amp;ldquo;B&amp;rdquo;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¬¬äºŒæ¬¡ä¿®æ”¹&lt;/strong&gt;ï¼šäº‹åŠ¡ 300 æŠŠ &amp;ldquo;B&amp;rdquo; æ”¹ä¸º &amp;ldquo;C&amp;rdquo;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å†…å­˜ä¸­çš„è®°å½•ï¼ˆæœ€æ–°ç‰ˆï¼‰ä¸ Undo Logï¼ˆå†å²ç‰ˆï¼‰çš„è¿æ¥å…³ç³»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;
&lt;table style=&#34;border-spacing:0;padding:0;margin:0;border:0;&#34;&gt;&lt;tr&gt;&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24
&lt;/span&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td style=&#34;vertical-align:top;padding:0;margin:0;border:0;;width:100%&#34;&gt;
&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ã€å†…å­˜ä¸­çš„æœ€æ–°è®°å½•ã€‘
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| Name: C                | &amp;lt;--- å½“å‰æ•°æ®
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_TRX_ID: 300         | &amp;lt;--- æœ€è¿‘æ˜¯è¢«äº‹åŠ¡ 300 æ”¹çš„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_ROLL_PTR: 0x3333    | ---+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------    | æŒ‡å‘ä¸Šä¸€ç‰ˆ
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       +----------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       v
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;ã€Undo Log ä¸­çš„å†å²è®°å½•ã€‘
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| Name: B                | &amp;lt;--- å†å²ç‰ˆæœ¬ 1
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_TRX_ID: 200         | &amp;lt;--- å½“æ—¶æ˜¯è¢«äº‹åŠ¡ 200 æ”¹çš„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_ROLL_PTR: 0x2222    | ---+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------    | æŒ‡å‘æ›´æ—©çš„ä¸€ç‰ˆ
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;                              |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       +----------------------+
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       |
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;       v
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| Name: A                | &amp;lt;--- å†å²ç‰ˆæœ¬ 2 (æœ€æ—©)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_TRX_ID: 100         | &amp;lt;--- å½“æ—¶æ˜¯è¢«äº‹åŠ¡ 100 æ’å…¥çš„
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;| DB_ROLL_PTR: null      | &amp;lt;--- æ²¡æœ‰æ›´æ—©çš„äº†
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;--------------------------
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è§£è¯»&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MVCC å°±æ˜¯é ç€è¿™ä¸ªé“¾æ¡ï¼Œæ ¹æ® Read View è§„åˆ™ï¼Œåˆ¤æ–­è‡ªå·±è¯¥è¯»å“ªä¸€ä¸ªæ–¹å—é‡Œçš„æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœäº‹åŠ¡ 300 è¿˜æ²¡æäº¤ï¼Œåˆ«çš„äº‹åŠ¡æ¥çœ‹ï¼Œå‘ç° ID=300 è¿˜æ˜¯æ´»è·ƒçš„ï¼ˆä¸å¯è§ï¼‰ï¼Œå°±ä¼šé¡ºç€ &lt;code&gt;0x3333&lt;/code&gt; æ‰¾ä¸‹å»ï¼Œè¯»åˆ° &amp;ldquo;Name: B&amp;rdquo;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3-read-view-è¯»è§†å›¾--æ•°æ®çš„è£åˆ¤&#34;&gt;3. Read View (è¯»è§†å›¾) â€”â€” æ•°æ®çš„â€œè£åˆ¤â€
&lt;/h4&gt;&lt;p&gt;å½“äº‹åŠ¡è¿›è¡Œ&lt;strong&gt;å¿«ç…§è¯»&lt;/strong&gt;ï¼ˆæ™®é€šçš„ &lt;code&gt;SELECT&lt;/code&gt;ï¼‰æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª &lt;strong&gt;Read View&lt;/strong&gt;ã€‚å®ƒå†³å®šäº†ä½ èƒ½çœ‹åˆ°ç‰ˆæœ¬é“¾ä¸Šçš„å“ªä¸€ä¸ªç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;Read View åŒ…å«æ ¸å¿ƒä¿¡æ¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;m_ids&lt;/code&gt;&lt;/strong&gt;ï¼šç”Ÿæˆ Read View æ—¶ï¼Œç³»ç»Ÿé‡Œæ‰€æœ‰**æ´»è·ƒï¼ˆæ²¡æäº¤ï¼‰**çš„äº‹åŠ¡ ID åˆ—è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;min_trx_id&lt;/code&gt;&lt;/strong&gt;ï¼š&lt;code&gt;m_ids&lt;/code&gt; é‡Œæœ€å°çš„ IDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;max_trx_id&lt;/code&gt;&lt;/strong&gt;ï¼šç”Ÿæˆ Read View æ—¶ï¼Œç³»ç»Ÿå°†åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ IDã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;creator_trx_id&lt;/code&gt;&lt;/strong&gt;ï¼šå‘èµ·è¿™ä¸ªæŸ¥è¯¢çš„äº‹åŠ¡ IDã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;53-æ ¸å¿ƒé€»è¾‘ç‰ˆæœ¬å¯è§æ€§ç®—æ³•&#34;&gt;5.3 æ ¸å¿ƒé€»è¾‘ï¼šç‰ˆæœ¬å¯è§æ€§ç®—æ³•
&lt;/h3&gt;&lt;p&gt;äº‹åŠ¡å»è¯»ä¸€è¡Œæ•°æ®æ—¶ï¼Œæ€ä¹ˆåˆ¤æ–­èƒ½ä¸èƒ½çœ‹åˆ°ï¼Ÿè¿™éœ€è¦æ‹¿è¿™è¡Œæ•°æ®çš„ &lt;strong&gt;äº‹åŠ¡ID&lt;/strong&gt; (&lt;code&gt;DB_TRX_ID&lt;/code&gt;) å»è·Ÿæˆ‘çš„ &lt;strong&gt;Read View&lt;/strong&gt; å¯¹ç…§ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®©ä½ å½»åº•æ˜ç™½ï¼Œæˆ‘ä»¬æ¥è®¾å®šä¸€ä¸ªå…·ä½“çš„**ã€å®æˆ˜åœºæ™¯ã€‘**ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æˆ‘æ˜¯è°&lt;/strong&gt;ï¼šäº‹åŠ¡ ID = &lt;strong&gt;300&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å½“æ—¶çš„å±€åŠ¿ (Read View)&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;m_ids&lt;/code&gt; (æ´»è·ƒåˆ—è¡¨)&lt;/strong&gt;ï¼š&lt;strong&gt;[100, 200]&lt;/strong&gt;ã€‚æ„æ€æ˜¯ï¼šå½“æˆ‘ç”Ÿæˆ Read View è¿™ä¸€åˆ»ï¼Œäº‹åŠ¡ 100 å’Œ 200 è¿˜åœ¨è·‘ï¼Œè¿˜æ²¡æäº¤ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;min_trx_id&lt;/code&gt; (æœ€å°æ´»è·ƒ)&lt;/strong&gt;ï¼š&lt;strong&gt;100&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;max_trx_id&lt;/code&gt; (ä¸‹ä¸ªID)&lt;/strong&gt;ï¼š&lt;strong&gt;301&lt;/strong&gt;ã€‚æ„æ€æ˜¯ï¼šç³»ç»Ÿä¸‹ä¸€ä¸ªè¦åˆ†é…çš„äº‹åŠ¡ ID æ˜¯ 301ï¼ˆå³æ‰€æœ‰ &amp;gt; 300 çš„éƒ½æ˜¯æœªæ¥æ‰å‘ç”Ÿçš„ï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘å»è¯»ä¸€è¡Œæ•°æ®ï¼Œæ ¹æ®è¿™è¡Œæ•°æ® &lt;code&gt;DB_TRX_ID&lt;/code&gt; çš„ä¸åŒï¼Œä¼šæœ‰ 4 ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;h4 id=&#34;1-è§„åˆ™ä¸€è¿™æ˜¯æˆ‘è‡ªå·±æ”¹çš„å—&#34;&gt;1. è§„åˆ™ä¸€ï¼šè¿™æ˜¯æˆ‘è‡ªå·±æ”¹çš„å—ï¼Ÿ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ¤æ–­&lt;/strong&gt;ï¼š&lt;code&gt;DB_TRX_ID&lt;/code&gt; == &lt;strong&gt;300 (æˆ‘)&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šâœ… &lt;strong&gt;å¯è§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£é‡Š&lt;/strong&gt;ï¼šæˆ‘å½“ç„¶èƒ½çœ‹åˆ°æˆ‘è‡ªå·±ä¿®æ”¹çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-è§„åˆ™äºŒè¿™æ˜¯è€å‰è¾ˆæ”¹çš„å—&#34;&gt;2. è§„åˆ™äºŒï¼šè¿™æ˜¯â€œè€å‰è¾ˆâ€æ”¹çš„å—ï¼Ÿ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ¤æ–­&lt;/strong&gt;ï¼š&lt;code&gt;DB_TRX_ID&lt;/code&gt; &amp;lt; &lt;strong&gt;100 (æœ€å°æ´»è·ƒ)&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šâœ… &lt;strong&gt;å¯è§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£é‡Š&lt;/strong&gt;ï¼šæ¯”å¦‚ ID=50ã€‚è¯´æ˜åœ¨æˆ‘ç”Ÿæˆ Read View ä¹‹å‰ï¼Œè¿™ä¸ªäº‹åŠ¡æ—©å°±æäº¤å®Œäº‹äº†ï¼Œæ•°æ®å·²ç»ç¨³å®šäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3-è§„åˆ™ä¸‰è¿™æ˜¯æœªæ¥äººæ”¹çš„å—&#34;&gt;3. è§„åˆ™ä¸‰ï¼šè¿™æ˜¯â€œæœªæ¥äººâ€æ”¹çš„å—ï¼Ÿ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ¤æ–­&lt;/strong&gt;ï¼š&lt;code&gt;DB_TRX_ID&lt;/code&gt; &amp;gt;= &lt;strong&gt;301 (æœ€å¤§ID)&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šâŒ &lt;strong&gt;ä¸å¯è§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£é‡Š&lt;/strong&gt;ï¼šæ¯”å¦‚ ID=400ã€‚è¿™æ˜¯åœ¨æˆ‘å¯åŠ¨ï¼ˆæˆ–æ‹ç…§ï¼‰ä¹‹åï¼Œæ‰æ–°æ¥çš„äº‹åŠ¡ä¿®æ”¹çš„ã€‚ä¸ç®¡å®ƒææ²¡æäº¤ï¼Œå¯¹äºâ€œè¿‡å»â€çš„æˆ‘æ¥è¯´ï¼Œè¿™æ˜¯æœªæ¥çš„äº‹ï¼Œæˆ‘ä¸èƒ½ç©¿è¶Šæ—¶ç©ºå»çœ‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;4-è§„åˆ™å››è¿™æ˜¯è¿˜æ²¡äº¤å·çš„åŒç­åŒå­¦æ”¹çš„å—&#34;&gt;4. è§„åˆ™å››ï¼šè¿™æ˜¯â€œè¿˜æ²¡äº¤å·çš„åŒç­åŒå­¦â€æ”¹çš„å—ï¼Ÿ
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åˆ¤æ–­&lt;/strong&gt;ï¼š&lt;code&gt;DB_TRX_ID&lt;/code&gt; è½åœ¨ [100, 301) ä¹‹é—´ï¼Œä¸” &lt;strong&gt;åœ¨ &lt;code&gt;m_ids&lt;/code&gt; åˆ—è¡¨ [100, 200] é‡Œ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šâŒ &lt;strong&gt;ä¸å¯è§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£é‡Š&lt;/strong&gt;ï¼šæ¯”å¦‚ ID=100 æˆ– 200ã€‚è™½ç„¶ä»–ä»¬ ID æ¯”æˆ‘å°ï¼ˆå¼€å§‹å¾—æ—©ï¼‰ï¼Œä½†æˆ‘ç”Ÿæˆå¿«ç…§çš„é‚£ä¸€åˆ»ï¼Œä»–ä»¬&lt;strong&gt;è¿˜æ²¡æäº¤&lt;/strong&gt;ã€‚ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆé¿å…è„è¯»ï¼‰ï¼Œæˆ‘ä¸èƒ½çœ‹ä»–ä»¬ä¿®æ”¹çš„æ•°æ®ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;ç‰¹ä¾‹&lt;/em&gt;ï¼šå¦‚æœ ID=250ï¼ˆä¸åœ¨æ´»è·ƒåˆ—è¡¨é‡Œï¼‰ï¼Œè¯´æ˜ä»–åœ¨æˆ‘ç”Ÿæˆå¿«ç…§å‰å·²ç»è¿…é€Ÿæäº¤äº†ï¼Œé‚£å°±&lt;strong&gt;å¯è§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ”„ &lt;strong&gt;å¦‚æœä¸å¯è§æ€ä¹ˆåŠï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;é¡ºç€ç‰ˆæœ¬é“¾ (&lt;code&gt;DB_ROLL_PTR&lt;/code&gt;) å¾€å›æ‰¾ä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œç»§ç»­å¥—ç”¨ä¸Šè¿°è§„åˆ™ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¯è§çš„ç‰ˆæœ¬ä¸ºæ­¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;54-å…³é”®åŒºåˆ«rc-å’Œ-rr-ä¸­çš„-mvcc&#34;&gt;5.4 å…³é”®åŒºåˆ«ï¼šRC å’Œ RR ä¸­çš„ MVCC
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;é‡è¦æç¤º&lt;/strong&gt;ï¼šä¸Šé¢ &lt;strong&gt;5.3 èŠ‚çš„å¯è§æ€§ç®—æ³•è§„åˆ™æ˜¯é€šç”¨çš„&lt;/strong&gt;ï¼æ— è®ºæ˜¯ RC è¿˜æ˜¯ RR çº§åˆ«ï¼ŒInnoDB åœ¨åˆ¤æ–­â€œèƒ½ä¸èƒ½çœ‹â€æ—¶ï¼Œç”¨çš„éƒ½æ˜¯åŒä¸€å¥—è§„åˆ™ã€‚&lt;/p&gt;
&lt;p&gt;å®ƒä»¬çš„å”¯ä¸€åŒºåˆ«åœ¨äºï¼š&lt;strong&gt;Read View (é‚£å¼ ç…§ç‰‡) ç”Ÿæˆçš„æ—¶æœºä¸åŒ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1-åœ¨-rc-è¯»å·²æäº¤-çº§åˆ«ä¸‹&#34;&gt;1. åœ¨ RC (è¯»å·²æäº¤) çº§åˆ«ä¸‹
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼š&lt;strong&gt;æ¯æ¬¡æ‰§è¡Œ &lt;code&gt;SELECT&lt;/code&gt; è¯­å¥æ—¶ï¼Œéƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„ Read View&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä½ æ‰§è¡Œäº†ä¸¤æ¬¡æŸ¥è¯¢ï¼Œä¸­é—´æœ‰åˆ«çš„äº‹åŠ¡æäº¤äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ï¼Œç”Ÿæˆçš„&lt;strong&gt;æ–° Read View&lt;/strong&gt; ä¼šå‘ç°é‚£ä¸ªäº‹åŠ¡å·²ç»ä¸åœ¨æ´»è·ƒåˆ—è¡¨ (&lt;code&gt;m_ids&lt;/code&gt;) é‡Œäº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®è§„åˆ™ï¼Œæ•°æ®å°±å˜å¾—&lt;strong&gt;å¯è§&lt;/strong&gt;äº†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ RC ä¼šå‘ç”Ÿ&lt;strong&gt;ä¸å¯é‡å¤è¯»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-åœ¨-rr-å¯é‡å¤è¯»--mysql-é»˜è®¤çº§åˆ«ä¸‹&#34;&gt;2. åœ¨ RR (å¯é‡å¤è¯») â€”â€” MySQL é»˜è®¤çº§åˆ«ä¸‹
&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ—¶æœº&lt;/strong&gt;ï¼š&lt;strong&gt;åªåœ¨äº‹åŠ¡ç¬¬ä¸€æ¬¡æ‰§è¡Œ &lt;code&gt;SELECT&lt;/code&gt; æ—¶ç”Ÿæˆä¸€ä¸ª Read View&lt;/strong&gt;ï¼Œåç»­æ‰€æœ‰çš„æŸ¥è¯¢éƒ½&lt;strong&gt;å¤ç”¨&lt;/strong&gt;è¿™åŒä¸€ä¸ª Read Viewã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä¸ç®¡å¤–éƒ¨ä¸–ç•Œæ€ä¹ˆå˜ï¼Œä½ æ‰‹é‡Œæ‹¿çš„æ°¸è¿œæ˜¯äº‹åŠ¡åˆšå¼€å§‹æ—¶çš„é‚£å¼ â€œæ—§ç…§ç‰‡â€ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨ç…§ç‰‡é‡Œï¼Œé‚£äº›å½“æ—¶æ²¡æäº¤çš„äº‹åŠ¡ï¼Œæ°¸è¿œéƒ½æ˜¯â€œæ²¡æäº¤â€çš„çŠ¶æ€ï¼ˆä¾ç„¶åœ¨ &lt;code&gt;m_ids&lt;/code&gt; é‡Œï¼‰ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®è§„åˆ™ï¼Œä»–ä»¬ä¿®æ”¹çš„æ•°æ®æ°¸è¿œ&lt;strong&gt;ä¸å¯è§&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ RR èƒ½å®ç°&lt;strong&gt;å¯é‡å¤è¯»&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ğŸ” ä¸€å¥è¯æ€»ç»“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RC&lt;/strong&gt;ï¼šæ¯æ¬¡è¯»éƒ½æ›´æ–°è§†å›¾ï¼ˆå®æ—¶ç›´æ’­ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;RR&lt;/strong&gt;ï¼šåªåœ¨å¼€å§‹æ—¶ç”Ÿæˆè§†å›¾ï¼ˆå½•åƒå›æ”¾ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç®—æ³•&lt;/strong&gt;ï¼šæ‹¿ç€è§†å›¾æ‰¾æ•°æ®çš„é€»è¾‘ï¼Œä¸¤è€…å®Œå…¨ä¸€æ ·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;55-æ€»ç»“&#34;&gt;5.5 æ€»ç»“
&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;MVCC = éšè—å­—æ®µ + Undo Log (ç‰ˆæœ¬é“¾) + Read View (å¯è§æ€§åˆ¤æ–­)&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒè®© MySQL åœ¨ RR çº§åˆ«ä¸‹ï¼Œè¯»æ“ä½œä¸éœ€è¦åŠ é”ï¼Œæå¤§æå‡äº†å¹¶å‘æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒåƒä¸€ä¸ªæ—¶å…‰æœºï¼Œè®©äº‹åŠ¡åªèƒ½çœ‹åˆ°å±äºå®ƒé‚£ä¸ªæ—¶åˆ»çš„æ•°æ®å¿«ç…§ã€‚&lt;/li&gt;
&lt;/ul&gt;
</description>
        </item>
        
    </channel>
</rss>
